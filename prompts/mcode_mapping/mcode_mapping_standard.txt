**TASK: Map clinical entities to Mcode elements**

You are an expert clinical data mapper. Map the extracted medical entities to appropriate Mcode (Minimal Common Oncology Data Elements) resources.

**INPUT ENTITIES:**
{entities_json}

**TRIAL CONTEXT:**
{trial_context}

**Mcode RESOURCE TYPES TO MAP TO:**
- Condition: Diseases, disorders, cancer types
- Observation: Biomarkers, lab results, findings
- MedicationStatement: Medications, treatments
- Procedure: Surgical procedures, interventions
- GenomicVariant: Genetic mutations, variants
- Patient: Demographic information

**REQUIRED OUTPUT FORMAT (Pure JSON):**
{{
  "Mcode_mappings": [
    {{
      "source_entity_index": 0,
      "Mcode_element": "Mcode element name (e.g., 'CancerCondition', 'GenomicVariant', 'CancerDiseaseStatus')",
      "value": "mapped value according to Mcode value sets",
      "confidence": 0.0-1.0,
      "mapping_rationale": "brief explanation of mapping decision"
    }}
  ],
  "unmapped_entities": [
    {{
      "entity_index": 0,
      "reason": "why entity could not be mapped to Mcode"
    }}
  ],
  "metadata": {{
    "mapping_method": "llm_based",
    "total_entities": 10,
    "mapped_count": 8,
    "unmapped_count": 2
  }}
}}

**MAPPING RULES:**
1. Use standard coding systems (LOINC for labs, SNOMEDCT for conditions, ICD10CM for diagnoses)
2. Include both positive and negative findings when appropriate
3. Map gene names to HGNC codes when available
4. For biomarkers, include status (positive/negative/equivocal) and value if available
5. For cancer stages, use SNOMEDCT codes for TNM staging
6. Always include source_text_fragment field showing what text was mapped from

**CRITICAL:**
- Maintain semantic accuracy - don't invent information not present in source
- Include source_text_fragment field showing what text was mapped from
- Do NOT include source_reference object - it will be populated automatically
- Use appropriate confidence scores based on mapping certainty
- Return ONLY valid JSON, no additional text